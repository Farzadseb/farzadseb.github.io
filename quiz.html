<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>A1 Quiz</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="style.css">

<style>
.correct { background:#c8f7c5 !important; }
.wrong { background:#f7c5c5 !important; }
</style>
</head>

<body>

<h1 class="title">üìù A1 Quiz</h1>

<div class="card">
  <div id="question" class="word"></div>
  <div id="choices" class="nav-grid"></div>
</div>

<button onclick="location.href='index.html'">‚¨Ö Back</button>

<script>
let data = {};
let words = [];
let currentWord = "";

/* ---------- LOAD FULL DICTIONARY ---------- */
fetch("pdcs_a1.json")
  .then(r => r.json())
  .then(j => {
    data = j;
    words = Object.keys(data);   // ‚úÖ ⁄©ŸÑ ÿØ€å⁄©ÿ¥ŸÜÿ±€å
    nextQuestion();
  });

/* ---------- NEXT QUESTION ---------- */
function nextQuestion() {
  const q = words[Math.floor(Math.random() * words.length)];
  currentWord = q;

  const qBox = document.getElementById("question");
  qBox.innerHTML = `
    ${q}
    <div class="en" style="margin-top:10px;font-size:1.6rem">
      ${data[q].example?.en || ""}
    </div>
  `;

  const correct = data[q].fa;
  let options = [correct];

  while (options.length < 4) {
    const r = words[Math.floor(Math.random() * words.length)];
    const f = data[r].fa;
    if (!options.includes(f)) options.push(f);
  }

  options.sort(() => Math.random() - 0.5);

  const box = document.getElementById("choices");
  box.innerHTML = "";

  options.forEach(o => {
    const b = document.createElement("button");
    b.innerText = o;
    b.onclick = () => checkAnswer(b, o);
    box.appendChild(b);
  });
}

/* ---------- CHECK ANSWER ---------- */
function checkAnswer(btn, ans) {
  const correct = data[currentWord].fa;

  if (ans === correct) {
    btn.classList.add("correct");
  } else {
    btn.classList.add("wrong");
    addWrongToLeitner(currentWord);
  }

  setTimeout(nextQuestion, 900);
}

/* ---------- LEITNER ---------- */
function addWrongToLeitner(word) {
  let l = JSON.parse(localStorage.getItem("leitner")) || {};
  l[word] = { box:1, last:Date.now() };
  localStorage.setItem("leitner", JSON.stringify(l));
}
</script>

</body>
</html>
