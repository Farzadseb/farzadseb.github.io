<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>A1 Quiz</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --bg:#f4f6fb;
  --card:#ffffff;
  --primary:#5b7cff;
  --correct:#c7f3d0;
  --wrong:#f7c7c7;
  --text:#111;
}

body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"SF Pro",Segoe UI,Roboto;
  background:var(--bg);
  color:var(--text);
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:24px 16px;
}

h1{
  font-size:2.6rem;
  margin-bottom:12px;
}

.card{
  width:100%;
  max-width:520px;
  background:var(--card);
  border-radius:22px;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
  padding:22px;
  margin-bottom:18px;
}

#modeBox{
  font-size:1.4rem;
  text-align:center;
  opacity:.75;
}

#question{
  font-size:2.6rem;
  text-align:center;
  margin:10px 0;
}

.speaker{
  font-size:3rem;
  text-align:center;
  cursor:pointer;
  user-select:none;
}

.nav-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
  margin-top:20px;
}

.nav-grid button{
  font-size:1.4rem;
  padding:14px 10px;
  border-radius:14px;
  border:2px solid #e5e7eb;
  background:#f9fafb;
  cursor:pointer;
}

.nav-grid button:active{
  transform:scale(.97);
}

.bottom{
  display:flex;
  gap:12px;
}

.bottom button{
  font-size:1.3rem;
  padding:14px 20px;
  border-radius:16px;
  border:none;
  background:var(--primary);
  color:white;
  cursor:pointer;
}
</style>
</head>

<body>

<h1>üìù A1 Quiz</h1>

<div id="modeBox" class="card"></div>

<div class="card">
  <div id="question"></div>
  <div class="speaker" id="speaker">üîä</div>
  <div id="choices" class="nav-grid"></div>
</div>

<div class="bottom">
  <button onclick="nextQuestion()">Next ‚û°</button>
  <button onclick="location.href='index.html'">‚¨Ö Back</button>
</div>

<script>
let data={}, keys=[], current="", mode=1, lastSpoken="";

fetch("pdcs_a1.json")
  .then(r=>r.json())
  .then(j=>{
    data=j.words||j;
    keys=Object.keys(data);
    nextQuestion();
  });

function speak(text){
  lastSpoken=text;
  speechSynthesis.cancel();
  const u=new SpeechSynthesisUtterance(text);
  u.lang="en-US";
  u.rate=0.8;
  speechSynthesis.speak(u);
}

document.getElementById("speaker").onclick=()=>{
  if(lastSpoken) speak(lastSpoken);
};

function nextQuestion(){
  if(keys.length<4) return;

  mode=Math.floor(Math.random()*3)+1;
  current=keys[Math.floor(Math.random()*keys.length)];

  const q=document.getElementById("question");
  const c=document.getElementById("choices");
  const m=document.getElementById("modeBox");

  q.innerHTML="";
  c.innerHTML="";

  let answers=[], correct="";

  // MODE 1
  if(mode===1){
    m.innerText="üéß English ‚Üí Persian";
    q.innerText=current;
    speak(current);
    correct=data[current].fa;
    answers.push(correct);
    while(answers.length<4){
      let r=data[keys[Math.floor(Math.random()*keys.length)]].fa;
      if(!answers.includes(r)) answers.push(r);
    }
  }

  // MODE 2
  if(mode===2){
    m.innerText="üéß English ‚Üí Definition";
    q.innerText=current;
    speak(current);
    correct=data[current].def;
    answers.push(correct);
    while(answers.length<4){
      let r=data[keys[Math.floor(Math.random()*keys.length)]].def;
      if(!answers.includes(r)) answers.push(r);
    }
  }

  // MODE 3
  if(mode===3){
    m.innerText="üéß Definition ‚Üí Persian";
    q.innerText="Listen";
    speak(data[current].def);
    correct=data[current].fa;
    answers.push(correct);
    while(answers.length<4){
      let r=data[keys[Math.floor(Math.random()*keys.length)]].fa;
      if(!answers.includes(r)) answers.push(r);
    }
  }

  answers.sort(()=>Math.random()-.5);

  answers.forEach(a=>{
    const b=document.createElement("button");
    b.innerText=a;
    b.onclick=()=>check(b,a,correct);
    c.appendChild(b);
  });
}

function check(btn,ans,correct){
  if(ans===correct){
    btn.style.background="var(--correct)";
  }else{
    btn.style.background="var(--wrong)";
    let l=JSON.parse(localStorage.getItem("leitner"))||{};
    l[current]={box:1,last:Date.now()};
    localStorage.setItem("leitner",JSON.stringify(l));
  }
  setTimeout(nextQuestion,800);
}
</script>

</body>
</html>
