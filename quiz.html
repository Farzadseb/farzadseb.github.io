<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>A1 Quiz</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --bg:#f2f4f8;
  --card:#ffffff;
  --primary:#2563eb;
  --correct:#d1fae5;
  --wrong:#fee2e2;
  --text:#111827;
}

body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display",Segoe UI,Roboto;
  background:var(--bg);
  color:var(--text);
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:20px;
}

h1{
  font-size:2.8rem;
  margin:10px 0 20px;
}

.card{
  width:100%;
  max-width:520px;
  background:var(--card);
  border-radius:20px;
  padding:22px;
  box-shadow:0 10px 28px rgba(0,0,0,.08);
  margin-bottom:18px;
}

#modeBox{
  text-align:center;
  font-size:1.6rem;
  opacity:.8;
}

#question{
  font-size:2.6rem;
  text-align:center;
  margin-top:10px;
}

#speaker{
  font-size:3rem;
  text-align:center;
  margin:14px 0;
  cursor:pointer;
}

#choices{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
}

#choices button{
  font-size:1.4rem;
  padding:14px 12px;
  border-radius:14px;
  border:none;
  background:#eef2ff;
  cursor:pointer;
}

#choices button:active{
  transform:scale(.97);
}

.bottom{
  display:flex;
  gap:14px;
}

.bottom button{
  font-size:1.3rem;
  padding:12px 20px;
  border-radius:14px;
  border:none;
  background:#e5e7eb;
}
</style>
</head>

<body>

<h1>üìù A1 Quiz</h1>

<div id="modeBox" class="card"></div>

<div class="card">
  <div id="question"></div>
  <div id="speaker">üîä</div>
  <div id="choices"></div>
</div>

<div class="bottom">
  <button onclick="nextQuestion()">Next</button>
  <button onclick="location.href='index.html'">Back</button>
</div>

<script>
let data={}, keys=[], current="", mode=1, lastSpoken="";

fetch("pdcs_a1.json")
.then(r=>r.json())
.then(j=>{
  data=j.words||j;
  keys=Object.keys(data);
  nextQuestion();
});

function speak(text){
  lastSpoken=text;
  speechSynthesis.cancel();
  const u=new SpeechSynthesisUtterance(text);
  u.lang="en-US";
  u.rate=0.8;
  speechSynthesis.speak(u);
}

document.getElementById("speaker").onclick=()=>{
  if(lastSpoken) speak(lastSpoken);
};

function nextQuestion(){
  if(keys.length<4) return;

  mode=Math.floor(Math.random()*3)+1;
  current=keys[Math.floor(Math.random()*keys.length)];

  const q=document.getElementById("question");
  const c=document.getElementById("choices");
  const m=document.getElementById("modeBox");

  q.innerHTML="";
  c.innerHTML="";

  let answers=[], correct="";

  if(mode===1){
    m.innerText="üéß English ‚Üí Persian";
    q.innerText=current;
    speak(current);
    correct=data[current].fa;
    answers.push(correct);
    while(answers.length<4){
      let r=data[keys[Math.floor(Math.random()*keys.length)]].fa;
      if(!answers.includes(r)) answers.push(r);
    }
  }

  if(mode===2){
    m.innerText="üéß English ‚Üí Definition";
    q.innerText=current;
    speak(current);
    correct=data[current].def;
    answers.push(correct);
    while(answers.length<4){
      let r=data[keys[Math.floor(Math.random()*keys.length)]].def;
      if(!answers.includes(r)) answers.push(r);
    }
  }

  if(mode===3){
    m.innerText="üéß Definition ‚Üí Persian";
    q.innerText="Listen";
    speak(data[current].def);
    correct=data[current].fa;
    answers.push(correct);
    while(answers.length<4){
      let r=data[keys[Math.floor(Math.random()*keys.length)]].fa;
      if(!answers.includes(r)) answers.push(r);
    }
  }

  answers.sort(()=>Math.random()-.5);

  answers.forEach(a=>{
    const b=document.createElement("button");
    b.innerText=a;
    b.onclick=()=>check(b,a,correct);
    c.appendChild(b);
  });
}

function check(btn,ans,correct){
  btn.style.background = ans===correct ? "var(--correct)" : "var(--wrong)";
  setTimeout(nextQuestion,700);
}
</script>

</body>
</html>
